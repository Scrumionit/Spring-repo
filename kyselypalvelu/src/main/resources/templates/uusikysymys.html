<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Uusi Kysymys</title>
  <meta charset="UTF-8" />
</head>

<body>
   <a th:href="@{/kysely/{id}(id=${kysely.kysely_id})}" class="btn btn-primary">Takaisin kyselyyn</a>
   <br>
  <h1>Uusi Kysymys</h1>

 <form th:object="${kysymys}" th:action="@{/kysely/{kyselyId}/tallennakysymys(kyselyId=${kysely.kysely_id})}" method="post">

    <label for="kysely">Kysely:</label>
    <input type="hidden" name="kyselyId" th:value="${kysely.kysely_id}" readonly="readonly" />
    <!--
    <select id="kysely" name="kysely_id" class="form-control">
      <option th:each="kysely : ${kyselyt}" th:value="${kysely.kysely_id}" th:text="${kysely.nimi}">
      </option>
    </select>
    -->
    <br />

    <label for="kysymystyyppi">Kysymystyyppi:</label>
            <select id="kysymystyyppi" th:field="*{kysymystyyppi.kysymystyyppi_id}" class="form-control">
                <option th:each="k: ${kysymystyypit}"
                    th:value="${k.kysymystyyppi_id}"
                    th:text="${k.nimi}">
                </option>
            </select><br>
    <br />
    <label for="kysymysteksti">Kysymys:</label>
    <br />
    <textarea rows="3" cols="30" id="kysymysteksti" th:field="*{kysymysteksti}"></textarea>
    <br />
    <!--
  <label for="vaihtoehdot">Vastausvaihtoehdot (pilkuilla erotettuna):</label>
    <br />
    <input type="text" id="vaihtoehdot" th:field="*{vaihtoehdot}" />
    <br />
    -->
    <div id="vaihtoehdotBlock" th:attr="style=${kysymys.kysymystyyppi == null or kysymys.kysymystyyppi.nimi != 'Avoin'} ? '' : 'display:none;'">
      <label for="vaihtoehdot">Vastausvaihtoehdot (pilkuilla erotettuna):</label>
      <br />
      <input type="text" id="vaihtoehdot" th:field="*{vaihtoehdot}" />
    </div>
       <script>
      (function () {
        const select = document.getElementById('kysymystyyppi');
        const block = document.getElementById('vaihtoehdotBlock');
        if (!select || !block) return;
        function toggle() {
          const text = select.options[select.selectedIndex].text.trim().toLowerCase();
          block.style.display = (text === 'avoin') ? 'none' : '';
        }
        select.addEventListener('change', toggle);
        document.addEventListener('DOMContentLoaded', toggle);
      })();
    </script>
    <br />
    <input type="submit" value="Tallenna Kysymys" />
  </form>

</body>

</html>